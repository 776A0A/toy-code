<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>JS Bin</title>
        <style>
            canvas {
                border: 1px solid;
            }
        </style>
    </head>
    <body>
        <video src="./video.ogv" controls id="v"></video>
        <canvas id="c1"></canvas>
        <canvas id="c2"></canvas>

        <script>
            const imgUrl =
                'https://images.pexels.com/photos/1083822/pexels-photo-1083822.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500'

            const ctx1 = c1.getContext('2d')
            const ctx2 = c2.getContext('2d')

            const image = new Image()
            image.crossOrigin = 'anonymous'
            image.src = imgUrl
            image.onload = () => {
                ctx2.drawImage(image, 0, 0, c2.width, c2.height)
            }

            v.onplay = () => {
                timerCallback()
            }

            function timerCallback() {
                if (v.paused || v.ended) return
                computeFrame()
                requestAnimationFrame(timerCallback)
            }

            function computeFrame() {
                ctx1.drawImage(v, 0, 0, c1.width, c1.height)
                const frame = ctx1.getImageData(0, 0, c1.width, c1.height)
                const l = frame.data.length / 4

                for (let i = 0; i < l; i++) {
                    const r = frame.data[i * 4]
                    const g = frame.data[i * 4 + 1]
                    const b = frame.data[i * 4 + 2]
                    if (r > 100 && g > 100 && b < 43) {
                        frame.data[i * 4 + 3] = 0
                    }
                }

                ctx2.clearRect(0, 0, c2.width, c2.height)
                ctx2.drawImage(image, 0, 0, c2.width, c2.height)
                ctx2.putImageData(frame, 10, 10)
            }
        </script>
    </body>
</html>
